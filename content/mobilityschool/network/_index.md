---
title: 네트워크
linkTitle: 네트워크
weight: 5
cascade:
  type: docs
sidebar:
  open: true
---

### Protocol
- 통신을 수행하는 규악

### OSI 7 계층
- 프로토콜이 아님
- 네트워크의 통신 계층을 7개의 계층으로 나누는 개념적 프레임워크
- 이점
  - 복잡한 시스템에 대한 이해 공유
  - 엔지니어가 작업을 이해하기 쉬워서 빠른 연구 및 개발이 가능

### 계층
#### Physical Layer(물리 계층)
- 물리적 통신 매체를 통해 전송하는 기술
- 케이블이나 Bluetooth, NFC, 데이터 전송 속도가 포함된 영역 

#### Datalink Layer
- 물리 계층이 이미 존재하는 네트워크를 통해 두 시스템을 연결하는데 사용

#### Network Layer
- 분산된 네트워크 하나 또는 연결된 여러 네트워크의 노드 또는 머신을 통한 라우팅 또는 전달 및 주소 지정

#### Transport Layer
- 데이터 전송, 순서 제어나 오류 제어 등을 수행

#### Session Layer
- 동기화 작업

#### Presentation Layer
- 데이터 표현, 압축, 암호화

#### Application Layer
- 사용자가 사용하는 특정 유형의 애플리케이션의 통신 방법
- https, ftp, smtp 등

### MAC
- Media Access Control Address
- 데이터 링크 계층에서 사용하는 주소 체계
- 하드웨어에 장착된 네트워크 인터페이스 카드의 고유한 이름
- 이더넷과 와이파이가 이 주소를 사용

### IP주소
- 인터넷을 이용하는 네트워크에서 컴퓨터를 구분하기 위한 주소 체계
- IPv4: 32비트 주소 체계, 8비트씩 묶어서 10진수 형태로 사용
  - 사용주소범위는 0.0.0.0 - 255.255.255.255
  - A 클래스: 0.0.0.0 - 127.255.255.255
  - B 클래스: 앞의 두개가 10으로 시작하는 것
    - 128.0.0.0 - 191.255.255.255
  - C 클래스: 앞의 세개가 110으로 시작하는 것
    - 192.0.0.0 - 223.255.255.255
  - D 클래스: 앞의 네개가 1110으로 시작하는 것
    - 224.0.0.0 - 239.255.255.255
  - E 클래스: 앞의 4개가 1111로 시작하는 것
    - 240.0.0.0 - 255.255.255.255
- 통신분류방식
  - 유니캐스트: 1:1 통식
  - 멀티캐스트: 그룹과의 통신
  - 브로드캐스트: 전체와 통신
  - 애니캐스트: 아무나 하나

### IPv6
- 128비트주소
- IPv6의 주소 고갈 문제를 해결하기 위해서 등장한 방식
- 현재는 IPv6를 사용하고 있음
- IPv4주소를 설정하면 네트워크 장비를 통해 외부로 전송이 될 때 IPv6로 변환되어서 전송
- 하나의 블럭에서 모두 동일한 값이면 하나로 줄여서 쓰는 것이 가능
- 모두 0인 블럭은 생략도 가능

### Loopback
- 자기 자신을 가리키기 위해 만들어진 IP 주소
- 현재 조작 중인 컴퓨터를 네트워크 연결 대상으로 인지하기 위해 만들어낸 주소
- IPv4에서는 127.0.0.1 ~ 127.255.255.255 이고 IPv6에서는 ::1(0::0::0::0::0::0::1)
- 운영체제 내부의 설정 파일에 localhost=127.0.0.1이라고 작성했기 때문에 localhost라고 하면 현재 컴퓨터에 접근하는 것, 리눅스에서는 /etc/hosts 파일에 연결되있음

### Private IP
- 대역
- A Class - 10.0.0.0 ~ 10.255.255.255
- B Class - 172.31.255.255
- C Class - 192.168.0.0 ~ 192.168.255.255
- 내부 네트워크 구성을 위해 사용하는 IP
- 이 IP를 가지고 인터넷에 직접 연결할 수 없음
- 최근에는 보안 그리고 IP를 유동으로 할당하기 위해서 사용

### 유동IP와 고정IP

### 동일한 네트워크
- 통신이 가능한 대역의 IP를 가지고 있어야 함

### subnet mask
- 네트워크 규모를 나타내기 위한 마스크
- 32비트 표시
- 맨 앞에서부터 연속된 1까지의 IP가 같으면 동일 네트워크로 간주해서 라우터를 통해서 외부로 나가지 않고 통신이 가능하도록 해줌

```bash
IP -> 0.0.0.7
subnet mask -> 255.255.0.0

0.0.0.7과 0.0.1.23이 통신을 할 때는 라우터를 통해 외부로 나가지 않고 외부로 통신 가능
```
- IPv4의 주소가 192.168.202.207이고 서브넷 마스크가 255.255.255.0임
- 제 컴퓨터와 라우터가 연결없이 통신할 수 있는 주소 대역은 192.168.202.0 ~ 192.168.202.255
- 이 IP 대역을 네트워크라고 함
- 동일 네트워크 대역을 표현할 때 서브넷 마스크를 이용하기도 하지만 비트수를 이용하기도함
- IP주소 뒤에 / 를 하고 일치해야 하는 비트수 작성
- IPv4의 주소가 192.168.202.207이고 서브넷 마스크가 255.255.255.0 표현을 192.168.202.207/24 로 표현
- 네트워크 대역으로 IP주소를 표현하면 일치해야 하는 부분을 네트워크, 일치하지 않아도 되는 부분 호스트
  - 192.168.202가 네트워크, 207이 호스트
  - 192.168.0.1/24 192.168.0.2/24 -> 24만 같으면 같은 네트워크, 외부로 나갈 필요없음
  - 192.168.0.1/32 192.168.0.2/32 -> 다른 네트워크, 외부로 나가야
- Public Cloud에서 같은 네트워크면 과금없음, 다른 네트워크면 과금 -> 같은 VPC로 설정해야함
- 하나의 네트워크 대역에서 할당할 수 있는 주소의 개수는 (주소의개수 -2)
- 시작, 끝 번호는 사용불가
- 시작 주소는 외부에서 이 네트워크 찾아오기 위한 대표주소, 마지막 주소는 broadcast 위한 주소
- broadcast는 전체와 통신을 하는 것
- 라우터에 IP하나 부여되고 동적 사설IP가 타임 쉐어링 방식으로 빠르게 교환
```bash
예)
IP: 192.168.202.207 -> b(202) = 11001010 
서브넷마스크: 255.255.252.0 -> b(252) = 11111100

범위 -> 192.168.200.0 ~ 192.168.203.255
대표주소 -> 192.168.200.0 (첫번째주소)
브로드캐스팅주소 -> 192.168.203.255 (마지막주소)
게이트웨이주소 -> 192.168.200.1 (대표주소와 브로드캐스팅 주소를 제외한 주소중 첫째나 마지막 주소로 관습적 부여, 설정하는 사람 마음)
즉 총IP개수: 3*256개
사용가능 IP개수: 3*256-2-1개
```

- Gateway: 외부 네트워크와 통신하기 위해서 내부 네트워크에서 접근해야 할 곳
  - 네트워크 장비와 연결되는 지점
  - 반드시 그런 것은 아니지만 주소 할당을 할 때 대표주소와 브로드캐스팅 주소를 제외한 주소중 첫째나 마지막 주소로 관습적 부여
- Default Subnet Mask: 서브넷 마스크를 설정하지 않으면 자동으로 설정되는 서브넷 마스크
  - A Class: 255.0.0.0
  - B Class: 255.255.0.0
  - C Class: 255.255.255.0

### 네트워크 수 계산
- 기업 내부에 네트워크 수를 계산하는 가장 쉬운 방법은 라우터를 기반으로 하는 것
- 라우터 장비만 네트워크를 분할 할 수 있음
- 라우터 장비와 연결된 하나의 회선은 항상 별도의 네트워크임
- 네트워크 수에 따라 IP 주소 대역이 서로 달라져야 함
- 이 작업은 인프라를 직접 구성할 때 필요함
- 라우터와 스위치: 라우터는 네트워크를 구분할 수 있지만 스위치는 네트워크를 분류 못함
- 최근에는 스위치의 기능을 라우터까지 확장해서 출시
- L3 Switch, L4 Switch 라 불리는데 L3가 라우터를 의미
- L3는 물리적으로 네트워크 분리, L2는 논리적으로 분리, L1은 증폭기 기능

### 라우팅
- 3계층의 주소를 보고 목적지로 전송하기 위한 경로를 설정하는 것
- IP주소는 서브넷 마스크를 이용해서 주소를 계층을 만든 것
- MAC ADDRESS는 주소 계층이 없음
- 계층이 없는 주소를 Flat Address

### 이더넷 스위칭
- 하나의 물리적인 네트워크 안에서 다시 네트워크를 분할하고자 할 때 라우터를 이용하지 않고 스위치를 이용해 분할
- 논리적으로 분할된 네트워크를 세그먼트라고 함
- 스위치는 세그먼트를 분할하기 위한 장비
- 스위치는 포트 별로 세그먼트를 분할할 수 있는 실제 스위치에서 이렇게 분할한 네트워크를 VLAN이라고 함

### 실제 구축
- 2중화를 해서 구축하는 것이 좋음(장애 대비, 부하 분산)
- 라우터와 스위치를 적절히 배치해서 트래픽을 분산해야 하고 이를 기반으로 bandwidth를 산정해 네트워크 구성을 해야

### 응용계층 프로토콜
- 실제 서비스와 관련된 프로토콜: 인간이 사용하는 서비스와 관련된 프로토콜
- 인터넷 관련 프로토콜
  - TCP: 연결형 프로토콜, 신뢰성높음, HTTPS
  - UDP: 비연결형 프로토콜, 전송속도빠름, datagram방식, DNS, NTMP, Apple의 APNS와 Google의 FCM
    ```bash
    스마트폰 푸쉬구조: 
    스마트폰->카카오서버->구글/애플서버->스마트폰
    스마트폰 IP 계속바뀌기 때문에 구글/애플서버에서 쏘아줌
    ```

### VLAN
- 하나의 물리적인 네트워크를 논리적으로 분할하는 것
- IP주소와 서브넷마스크를 이용해 분할
- 논리적으로 분할하게 되면 내부통신으로는 접근할 수 없음
- 스위치와 같은 장비로 분할하면 트래픽도 전달이 안됨
- IP와 서브넷 마스크 이용해 장비 없이도 가능
- cloud 환경에서 여러컴퓨터를 논리적으로 묶고자 할 때 이 개념을 사용
- 서버, 데이터서버, API서버, Application Server 등을 하나의 VLAN으로 묶어서 통신이 가능하도록 하고 외부로 노출시켜야 하는 컴퓨터만 퍼블릭 설정을 해 보안을 강화하고 트래픽을 최소로 사용하도록 설계

`192.168.0.0/24 -> 192.168.0.0/25 192`

### NAT Overload
- Dynamic NAT만으로는 publicIP 차단 효과 미비
- 컴퓨터의 애플리케이션은 특정 컴퓨터의 서비스를 이용할 목적으로 만들어짐
- 컴퓨터 애플리케이션은 컴퓨터에 접속 후 자신이 원하는 프로세스 또는 서비스에 요청전송
- 컴퓨터에서는 이렇게 프로세스를 구분하기 위한 PID(프로세스ID)를 사용하는데 외부 컴퓨터에서 접속 할 때는 PID를 이용해서 서비스를 찾지 않고 port의 개념을 이용해서 원하는 서비스를 요청
- 네트워크 장비에서 내부 네트워크의 컴퓨터 구별할 때 IP만 사용하는 것이 아니라 포트까지 이용해서 구별하게 되면 훨씐 더 많은 컴퓨터를 내부 네트워크에서 사용하는 것이 가능해짐
- NAT Overload라고 하기도 하고 PAT(Port Address Translation) 라고도 함

### NAT를 사용하는 환경에서 NAT 내부의 컴퓨터를 서버로 사용하고자 하는 경우
- 네트워크 장비에 들어가서 외부 IP와 포트에 내부 장비의 IP와 포트가 고정되서 변환이 되도록 해주면 됨
- 외부 IP를 이용해서 내부 컴퓨터에 접속 가능

### Access List
* 라우터 또는 컴퓨터를 통과하는 패킷 중 불필요하거나 나쁜 의도를 가진 패킷을 차단하기 위해서 작성
* 종류:
  * Standard Access List: 패킷의 허용 및 차단 기준이 출발지 IP
  * Extended Access List: 패킷의 허용 및 차단의 기준이 출발지 IP, 목적지 IP 주소, 프로토콜, 포트 번호 4가지
* 운영체제 내부에서는 일반적으로 포트 번호만 기재해서 방화벽에서 해제하고 차단하는데 이 경우는 permit all 또는 deny all

### Standard Access List
- permit이나 deny IP주소 와일드카드마스크(서브넷 마스크 반대 - 반드시 일치하는 것이 0, 일치하지 않아도 되는 것이 1)
  - 11.1.1.0/24 네트워크를 허용 -> ```permit 11.1.1.0 0.0.0.255```
  - permit any나 deny any를 이용하면 전체를 허용하거나 거부하는 것이 가능
  - 여러 줄로 작성하는 것이 가능, 위에서부터 순차적으로 적용
```
ex
- 11.1.1.0/24 네트워크에서 11.1.1.1 에 해당하는 컴퓨터만 허용하고 나머지는 모두 거부
- 그 이외 네트워크는 모두 허용(permit any나 deny any가 앞에 있으면 안됨, 위쪽이 작은 규모, 아래쪽으로 갈 수록 큰 규모)
- permit any나 deny any
=>
permit 11.1.1.1 0.0.0.0 (0.0.0.0 대신에 permit 다음에 host 라고 하면 이 경우도 하나의 컴퓨터)
deny 11.1.1.0 0.0.0.255
permit any
```

### Extended Access List
- permit 이나 deny를 먼저 쓰고 tcp | udp | ip 소스네트워크 목적지네트워크 [포트조건]
```
ex)
11.1.1.0/24 네트워크에서 11.1.2.0/24 네트워크로 향하는 20번 포트만 거부
=>
deny tcp 11.1.1.0 0.0.0.255 11.1.2.0 0.0.0.255 eq 20
```
- 모든 트래픽 허용 ```permit ip any any```
- 기억해야 할 포트: FTP->20/21 TELNET->23 SMTP(메일)->25 DNS->53 HTTP->80 HTTPS->443
- 실습
```
FTP는 파일 전송 프로토콜인데 TCP 서비스이고 포트번호는 20번과 21번 사용
11.1.1.0/24 네트워크가 파일 전송 하는 것을 금지시키고자 함
Access List에 어떻게 적어야 한가
=>
deny tcp 11.1.1.0 0.0.0.255 any eq 20
deny tcp 11.1.1.0 0.0.0.255 any eq 21
permit ip any any
```

### 네트워크 구성도
- 홈 네트워크 
  - 인터넷 <-> 모뎀 <-> 공유기 <-> 컴퓨터, 테블릿, 스마트폰
- 데이터 센터 네트워크
  - 안정적이고 빠른 대용량 서비스 제공을 목표로 함
  - 구성 방법
    - 3계층 디자인 - 예전에 많이 사용하던 방식
    - Core <-> Aggregation(속도, 흐름제어) <-> Access
    - 2계층 디자인 - 최근에 네트워크 속도가 빨라지면서 사용, Spine-Leaf 구조

### 프로토콜
- 통신을 하기 위한 규칙 규약
- 물리적 측면: 데이터 전송 매체 (케이블), 신호 규약, 회선 규격 등을 정의하는 것인데 최근에는 거의 이더넷만 사용
- 논리적 측면: 프로토콜 규격 등을 정의하는 것인데 최근에는 TCP/IP만 사용
- 프로토콜을 정의할 때 예전에는 비트 기반으로 많이 만들었는데 최근에는 문자 기반으로 많이 사용
  - 비트 기반의 프로토콜은 효율적이긴 하지만 사람이 읽기 어려움
- TCP/IP는 엄밀한 의미에서는 프로토콜이 아니고 프로토콜 스택
  - TCP와 IP는 별도의 계층에서 동작하는 프로토콜인데 이를 합쳐서 부름
  - TCP/IP 이외에도 UDP, ICMP, ARP, HTTP, SMTP, FTP, HTTPS 등이 포함되어 있음

### OSI 7계층과 TCP/IP
- OSI 7계층
- 전에는 프로토콜을 각 벤더들이 별도로 개발했기 때문에 호환되지 않는 시스템이나 애플리케이션이 많았음
- 하나의 프로토콜로 통합하고자 했던 노력으로 만들어진 것이 OSI 7계층
- 7개의 계층으로 모듈화 한 이유는 재사용 문제 때문: 하나로 만들면 재사용성이 떨어지고 이해하기 어려워짐

```
이름              데이터
Application       실제 데이터: 인간이 이해할 수 있는 데이터
Presentation      실제 데이터
Session           실제 데이터
Transport         Segments
Network           Packet
DataLink          Frames
Physical          Bits
```
- 2개 부분으로 분할
  - 5-7 계층: 상위 계층 - 애플리케이션 계층: 인간, 애플리케이션 개발자의 영역
  - 1-4 계층: 하위 계층 - Data Flow 계층: 기계, 네트워크 엔지니어의 영역
- TCP/IP 프로토콜 스택
  - 4개 계층으로 프로토콜을 정의
  - Application: OSI의 5-7 계층
  - Transport
  - Internet: OSI의 3계층
  - Network Access: OSI의 1, 2 계층
- 계층 별 기능을 설명할 때 OSI 7계층을 가지고 설명을 많이 함
### OSI 7계층 별 이해
- 1계층(물리 계층)
  - 물리적 연결과 관련된 정보
  - 장비로는 Hub, Repeater, Cable, Connector, Transiver(랜카드와 케이블을 연결해주는 장비), TAP(네트워크 모니터링이나 패킷 분석을 하기 위해서 전기 신호를 다른 장비로 복제해주는 장비) 등
- 2계층(데이터 링크 계층)
  - 전기 신호를 데이터 형태로 변환
  - 주소 정보를 정의하고 정확한 주소로 통신이 되도록 하는 역할을 수행
  - 1계층에서는 주소라는 개념이 존재하지 않지만 출발지 주소와 목적지 주소를 확인하고 자신에게 전송된 것인지 확인
  - 에러 탐지도 수행
  - 2계층 장비는 NIC(Network Interface Card)와 Switch
  - 사용하는 주소 체계는 MAC Address
  - 2계층 장비들은 MAC Address를 이해할 수 있는 장비
  - NIC 동작 방식: 전기 신호를 데이터 형태로 생성 후 목적지 MAC주소와 출발지 MAC 주소를 확인, 자신의 MAC주소 확인, 목적지 MAC주소와 자신의 MAC주소가 일치하면 데이터를 처리하고 다르면 데이터를 파기
  - Switch: 허브와 유사하게 여러 개의 포트로 구성
    - MAC주소 테이블을 가지고 있어서 통신을 하면 MAC 주소를 학습해서 테이블에 저장할 수 있음
    - 단말들이 통신할 때 포트를 적절히 필터링하고 정확한 포트로 포워딩
    - 허브는 어느 한 순간 하나의 장비만 전송이 가능하지만 Switch는 동시에 데이터 전송이 가능
- 3계층(네트워크 계층)
  - 논리적인 주소가 정의
  - 사용자가 환경에 맞게 변경할 수 있고 주소를 네트워크 주소 부분과 호스트 주소 부분으로 나누어서 할당할 수 있음
  - 3계층 장비가 라우터
  - IP를 이해해서 다른 네트워크를 찾아가는 장비임
- 4계층(전송 계층)
  - 데이터들이 정상적으로 잘 전송이 되는지 확인하는 역할
  - 데이터는 하나의 묶음으로 전송되지 않고 일정한 크기(Packet) 단위로 분할해서 보내게 되는데 중간에 퍂킷이 유실되거나 순서가 바뀔 수 있어 이러한 문제를 해결
  - 패킷을 만들 때 Sequence Number를 붙이고 받는 쪽에서는 ACK(Acknowledgement) Number를 전송
  - 컴퓨터 내에서 애플리케이션을 구분하기 위해서 port를 부여
  - 4계층에서 동작하는 장비는 Load Balancer와 Firewall: 장비라고 하기도 하고 Software라고 하기도 함
- 5계층(세션 계층)
  - 연결 해제와 연결 유지하는 역할
  - 에러 복구와 중단된 통신에 대한 재전송 수행
  - 연결 해제와 유지를 위해서 특별한 키를 발급해서 키를 가지고 실제 연결하는 컴퓨터를 구분
- 6계층(프레젠테이션)
  - 구문 변환, 데이터 압축, 인코딩과 디코딩을 수행
  - 데이터의 형식을 맞추는 계층
- 7계층(애플리케이션 계층)
  - 애플리케이션 프로세스를 정의하는 계층
  - OSI 전 계층을 수행하는 장비는 Gateway(Router를 Gateway로 보는 경우가 많음)

### 통신과정
- 데이터를 전송을 하게 되면 상위 계층에서 하위 계층으로 데이터를 전송
- 전송을 받는 쪽에서는 하위 계층에서 상위 계층으로 데이터를 전송
- 데이터를 보내는 과정을 Encapsulation 그리고 받는 과정을 Decapsulation이라고 함
- 보내는 쪽 
  - Data -> 4계층(4계층 헤더 + Data: Segment) -> 3계층(3계층 헤더 + 4계층 헤더+ 데이터: Packet) -> 2계층(2계층 헤더+3계층헤더+4계층헤더+데이터+FCS) -> 1계층(전기적 신호로 변환)
- 받는 쪽은 반대 과정
- MSS와 MTU
  - MSS(Maximum Segment Size): 4계층에서 사용할 수 있는 데이터의 최대 크기
  - MTU(Maximum Transmission Unit): 네트워크 계층에서 한 번에 보낼 수 있는 데이터의 최대 크기, 이더넷에서는 1500바이트

## 네트워크 구분과 구성 요소
### 네트워크 연결 구분
- 규모에 따른 구분
  - LAN: Local Area Network - 사무실, 건물 하나 정도의 소규모 네트워크
  - MAN: Metropolitan Area Network - 하나의 도시 정도를 네트워크로 연결
  - WAN: Wide Area Network - 먼 거리를 연결한 네트워크
  - PAN: Personal Area Network - 개인의 작업 공간을 중심으로 장치들을 서로 연결하기 위한 네트워크
- 도시 단위의 네트워크를 만들 때 통신사의 인프라를 이용하면 WAN, 자체 인프라를 이용하면 MAN이라고 하기도 함

### 회선에 따른 분류
- 인터넷 회선: 인터넷 접속을 위해 통신 사업자와 연결하는 회선
  - 가입자와 통신 사업자 간에 직접 연결되는 구조가 아니라 전송 선로 공유 기술을 이용
- 전용 회선: 가입자와 통신 사업자 간에 대역폭을 보장해주는 서비스
- 컴퓨터 - 스위치 - 라우터 - ISP(통신 사업자) - 라우터 - 스위치 - 컴퓨터
- 본사와 지사 연결이나 지사와 지사 연결 등에 사용
- 종류는 저속인 음성 전송 기술 기반이 있고 고속인 메트로 이더넷이 있음
- LLCF(Link Loss Carry Forward)
  - 한쪽 링크가 다운되면 이를 감지해 반대쪽 링크도 다운시키는 기능
  - 전용 회선을 이더넷으로 구성할 때 통신 사업자가 LLCF를 설정하지 않으면 한 사이트에 다운되더라도 반대쪽 사이트에서 회선이 살아있는 것처럼 보이기 때문에 회선 개통 한 후 회선사에서 LLCF 설정이 되어있는지 확인
- 인터넷 전용 회선: 인터넷 연결 회선에 대한 통신 대역폭을 보장해주는 서비스

### VPN(Virtual Private Network)
- 전용 회선이 아니지만 가상으로 직접 연결한 것 같은 효과가 나도록 만들어주는 네트워크 기술
- 통신 사업자 VPN
  - 통신 사업자가 VPN을 구성해주는 것
  - 하나의 건물에서만 VPN을 구성한다면 직접 구성하면 되지만 먼거리에 떨어져 있는 곳과도 통신이 가능한 VPN을 만들려면 회선 연결 비용이 증가하기 때문에 통신 사업자의 회선을 이용해서 구성함
  - MPLS VPN: 통신사업자는 전용선인 것처럼 보이게 하지만 실제로는 가입자를 구분하는 기술을 적용해서 시분할을 이용해서 서비스를 제공
  - 가입자 VPN: 일반 사용자가 가상 네트워크를 직접 구성하는 것

### DWDM(Dense Wavelength Division Multiplex): 파장 분할 다중화
- 광케이블로 데이터를 전송할 채널을 분할해서 데이터를 전송하는 것

### 네트워크 구성 요소
- NIC(Network Interface Card)
  - 직렬화, MAC Address, 흐름제어(Flow Control - 데이터를 안정적으로 주고받기 위해서 기존에 통신 중일 때 다른 네트워크에서 데이터 전송 중지 요청)
- 일반적으로 사용하는 NIC외에도 스토리지와 서버를 연결하는 NIC도 존재
- 고성능 클러스터링을 구현하기 위한 HPC(High Performance Computing)에서도 우리가 일반적으로 사용하는 NIC를 사용하지 않음
- 케이블과 커넥터
  - 1000BASE-T: 1000Mbps BASE채널 T케이블타입
  - 케이블 종류는 twistedpair(유선인터넷), 동축 케이블(TV 회선), 광케이블
- 스위치: 여러 장비를 연결하고 케이블을 한 곳으로 모아주는 역할을 수행
  - 스위치와 허브의 기능을 같이 하면 스위칭 허브라고 부르기도 하고 4계층이나 3계층의 역할까지 수행하는 스위치를 L3또는 L4스위치라고 함
- 라우터: 외부 네트워크와 통신하기 위한 장비
  - 정확한 방향으로 데이터가 전송되도록 하고 최적의 경로로 데이터를 포워딩
- 로드밸런서
  - 4계층 장비
  - 애플리케이션 계층에서 애플리케이션 프로토콜의 특징을 이해하고 동작하는 로드밸런서를 ADC(Application Delivery Controller)라고 함
  - 포트 주소를 확인하는 동시에 IP변환도 수행
  - 웹 서버를 구축할 때 많이 사용하는데 동일한 역할을 수행하는 웹 서버를 여러 대 만들고자 하는 경우 로드 밸런서를 웹 서버 앞에 두고 웹 서버를 여러 대 만든 다음 대표IP는 로드밸런서에게 부여하고 로드밸런서가 요청이 오면 웹 서버를 지정해서 전송하도록 함
  - 이런 원리로 동작하는 소프트웨어 중 하나가 nginx
  - 로드밸런서를 이용하게 되면 서비스 헬스 체크나 대용량 세션 처리 기능을 사용 가능
- 보안장비
  - 방화벽이나 IPS 등의 장비 또는 소프트웨어
  - 방화벽: OSI 7계층 중 4계층에서 동작해서 패킷의 3, 4, 계층 정보를 확인하고 패킷을 정책과 비교해서 버리거나 포워딩함
- 공유기
  - 2계층 스위치, 3계층 라우터, 4계층 NAT와 간단한 방화벽 기능을 모아높은 장비
  - 내부는 스위치와 무선AP, 라우터 부분으로 구성됨
- 모뎀
  - 공유의 LAN포트와 WAN 포트는 일반 이더넷이어서 100m 이상 먼 거리로 데이터를 보내지 못하기 때문에 먼거리 통신을 위해서 모뎀이 필요

## 네트워크 통신
### 네트워크에서 출발지에서 목적지로 데이터를 전송할 때 사용하는 통신 방식
- unicast
  - 1:1통신, 출발지와 목적지가 명확히 하나로 정해져 있는 통신 방식
  - 대다수의 통신은 unicast
- broadcast
  - 목적지 주소가 모든으로 표기되어 있는 통신 방식
  - unicast로 통신하기 전에 상대방의 정확한 위치를 알기 위해서 사용
  - 로컬 네트워크에서 모든 호스트의 패킷을 전달해야 할 때 사용
- multicast
  - multicast 그룹 주소를 이용해서 해당 그룹에 속한 다수의 호스트로 패킷을 전송하기 위한 통신 방식
  - IPTV와 같은 실시간 방송을 볼 때 사용하고 사내 방송이나 증권 시세 전송과 같이 단방향으로 다수에게 같은 내용을 전송할 때 사용
- anycast
  - 주소가 같은 호스트 중에서 가장 가깝거나 가장 효율적으로 서비스할 수 있는 호스트와 통신하는 방식
  - 도메인을 이용해서 인터넷을 할 때 가장 가까운 DNS 서버를 찾을 때 사용
- IPv6에서는 브로드캐스트라는 용어 대신 링크 로컬 멀티캐스트라고 함

### MAC Address
- 주소 체계
  - 변경할 수 없도록 하드웨어 고정되어 출하
  - 모든 네트워크 장비에는 MAC 주소를 할당해야 함
  - 한 제조업체에 하나 이상의 주소 풀을 주고 그 안에서 자체적으로 할당
  - 48비트로 구성되는데 앞의 24비트가 제조회사 코드(OUI)이고 뒤의 24비트(UAA)는 제조사에서 자체적으로 할당
  - 고유하지 않을 수 있는데 이유는 제조사의 실수나 코드의 부족 떄문인데 동일 네트워크 안에서만 같지 않으면 통신하는데 문제가 없음
  - ROM 고정되서 변경할 수 없도록 출하가 되지만 이 주소도 메모리에 적재되서 사용되므로 MAC주소를 변경해서 사용하는 것이 가능

### IP Address
- IPv4: 32비트로 만들고 표기할 때는 4개의 Octet(8비트)으로 나누고 각 Octet은 .으로 구분
- 각 Octet은 10진수로 표기
- 2개 부분으로 구성:
  - 네트워크 부분: 호스트들을 모은 네트워크를 지칭하는 주소, 네트워크 주소가 같으면 같은 로컬 네트워크
  - 호스트 부분: 하나의 네트워크내에 존재하는 호스트를 구분하기 위한 주소
- 네트워크 부분과 호스트 부분을 구분하는 경계점이 고정이 아님
- 호스트 IP 개수에 따라 네트워크 크기를 다르게 할당 가능,이를 위해서 클래스라는 개념을 도입
  - A 클래스는 약 1600만개의 IP주소를 가질 수 있음. 첫번째 점이 경계
  - B 클래스는 65536개의 IP주소를 가질 수 있음. 두번째 점이 경계
  - C 클래스는 256개의 IP주소를 가질 수 있음. 세번째 점이 경계
- 최근에는 조금 더 세밀하고 네트워크와 호스트 부분을 설정할 수 있음
- 사용 가능한 IP범위를 할 때도 이를 이용
  - 처음 IPv4를 만들 때 각 클래스 별로 별도의 주소 블록을 할당
  - A Class는 맨 앞 비트가 0으로 시작: 0.0.0.0 ~ 127.255.255.255
  - B Class는 맨 앞 두 비트가 10으로 시작: 128.0.0.0 ~ 191.255.255.255
  - C Class는 맨 앞 세 비트가 110으로 시작: 192.0.0.0 ~ 223.255.255.255
  - 만일 IP주소가 192.168.202.207이라면 기본적으로 C클래스
  - 네트워크 주소: 192.168.202.0
  - 브로드캐스트주소: 192.168.202.255
  - 실제 사용 가능한 IP 범위: 192.168.202.1 ~ 192.168.202.254 가 됨
  - 이를 조금 더 세분화시켜서 비트 단위로 분할 할 수 있는데 이를 서브네팅이라고 함
- IP 주소 부족 문제 해결
  - 인터넷을 사용하는 호스트 숫자가 폭발적으로 증가해서 IP주소가 부족해지는 문제가 발생
  - 이를 해결하기 위해서 가장 먼저 도입한 것은 클래스리스, 즉 CIDR
  - 두번째 도입으로 NAT와 사설IP주소
  - 세번째 도입 IPv6
- 클래스리스
  - 기존 클래스의 개념을 없앤 것으로 네트워크를 원하는 단위로 분할 할 수 있도록 한 것
  - 이를 위해서 subnet mask 라는 개념을 도입
  - subnet mask는 동일한 네트워크 크기를 표현하기 위한 주소
  - subnet mask를 표현하는 방법은 비트 수를 기재하는 방법과 10진수로 표현하는 방법 2가지
  - IP Address/비트수 또는 IP Address 10진수로 표기
  - 비트수로 표시하면 비트수만큼 같으면 동일한 네트워크로 간주, 10진수로 표현하면 이진수로 변환해서 1이 있는 부분까지가 동일하면 동일네트워크 간주
  - 라우터나 컴퓨터에 IP를 설정할 때 이 방식을 사용
  - 비트 수로 설정하지 않고 10진수로 설정
  - 네트워크를 설정할 때는 네트워크 대역안에 있는 어떤 IP주소를 할당해도 동일하게 적용
  - 컴퓨터의 IP를 설정할 때는 동일 네트워크 대역 안에서 정확하게 IP를 할당해야 함
  - 현재 컴퓨터의 IP는 192.168.202.207 서브넷마스크는 255.255.240.0(11111111.11111111.11110000.00000000) 
  - 즉 192.168.202.207/20로 표기
  - 라우터의 네트워크 설정을 한다면 192.168.200.0 255.255.255.240 으로 해야 하지만 이 주소 풀이 192.168.200.0 ~ 192.168.215.255 임 또는 192.168.201.1 255.255.240.0
  - 필요한 크개돌 분할하는 작업 subnetting
  - 네트워크 사용자 입장에서 서브네팅이 중요한 것은 서브네팅된 주소를 보고 사용할 수 있는 IP를 할당해야 함
  - 네트워크 설계자 입장에서는 호스트의 개수를 파악해서 적절한 서브네팅 작업을 해줘야 함
  - 방화벽을 설정할 때도 서브네팅이 필요함
  - 모든 컴퓨털를 지칭          0.0.0.0/0            웹 애플리케이션 서버가 보통 이렇게 설정
  - 컴퓨터 1대를 지칭            IP/32                 데이터베이스 서버의 경우 이렇게 설정하는 경우가 많음  
  - 일정 그룹의 컴퓨터를 지칭  네트워크주소/크기 애플리케이션 서버가 여러 대인 경우 데이터베이스는 이런식으로 설정
  - 퍼블릭 클라우드의 대부분 동일 네트워크 내에서의 통신 비용을 지불하지 않음
  - 퍼블릭 클라우드에서는 직접 설정하기 보다는 동일한 VPC로 묶으면 이 작업을 대신 수행해줌
- Public IP와 Private IP
  - 인터넷에 접속을 하려면 IP주소가 있어야 함
  - 인터넷을 할 때 사용할 수 있는 IP주주소를 Public IP라고 함
  - 인터넷을 연결하지 않고 네트워크를 구성하기 위해서 사용하는 IP주소를 Privcate IP라고 함
  - 인터넷에서 접속할려면 통신 사업자로부터 IP주소를 할당받거나 IP 할당 기관(KISA)에서 인터넷 독립기관 주소를 할당받은 후 할 수 있는데 직접 할당받는 것은 절차가 복잡하기 때문에 대부분은 통신 사업자로부터 할당을 받음
  - 인터넷에 접속하지 않거나 NAT(Network Address Translation) 기술을 사용할 경우 Private IP를 이용
  - Private IP를 가지고는 인터넷을 할 수 없지만 NAT 장비에서 Public IP로 변경해서 인터넷에 접속이 가능
  - Private IP 대역
    - 10.0.0.0/8          10.0.0.0 ~ 10.255.255.255
    - 172.16.0.0/12       172.16.0.0 ~ 172.31.255.255
    - 192.168.0.0/16      192.168.0.0 ~ 192.168.255.255
  - 회사 내부에서 Private Network을 구축할 때 보안 사으이 문제나 IP공유를 위해서 NAT를 사용하는데 이때 다른 사용자와 중복된 IP를 사용하면 안되는데 다른 사용자가 사용하고 있는 Public IP를 내부 네트워크의 IP로 할당을 하면 인터넷은 문제가 없지만 그 IP를 가진 컴퓨터와 통신은 안됨
- Bogon IP
  - 사용할 수 없는 IP 주소로 IANA(IP주소를 할당하는 최상위 기관) 가 여러가지 목적으로 예약해 높아서 Public IP로 사용할 수 없는 IP
  - 이 주소를 이용한 네트워크 접속 시도가 있을 때는 IP Spoofing(주소를 변조해서 공격)일 가능성이 높으므로 필터링 해야 함
  - 0.0.0.0/8 : This Network
  - 10.0.0.0/8 : Private IP
  - 100.64.0.0/10 : 캐리어 그레이드 NAT( 통신 사업자가 Private IP를 할다앟기 위해서 사용)
  - 127.0.0.0/8 : Loop Back Address
  - 169.254.0.0/16 : 링크 로컬
  - 192.0.0.0/24 : IETF 프로토콜 할당
  - 192.0.2.0/24 : 테스트용
  - 192.168.0.0/16 : Private IP
  - 224.0.0.0/4 : 멀티캐스트 예약
  - 255.255.255.255/32 : 브로드캐스트
- IP Address 발신자 확인 가능 https://whois.kisa.or.kr

### TCP와 UDP
- 4계층 프로토콜
- 포트가 이 계층에서 제공하는 주소
- 애플리케이션에서 사용하는 프로세스를 정확히 찾아가고 데이터를 분할한 패킷을 잘 쪼개고 조립하는 역할을 수행
- HTTP TCP는 90, HTTPS TCP는 443, SMTP TCP는 25 이런 식으로 알려진 포트를 Well Known 포트라 하고 IANA에서 등록해놓았고 1023 이하의 포트번호를 사용
- 애플리케이션에서도 IANA에 포트 번호를 등록할 수 있는데 이 때는 1024 ~ 49151 포트를 사용
  - MySQL이나 MariaDB는 3306 Oracle은 1521 MongoDB는 27017 Django는 8000 Tomcat 8080
  - 자주 사용하는 Application은 이 포트번호를 기억을 해두는 것이 좋음
- 49152 ~ 65535까지는 자동으로 할당되거나 Private 용도로 클라이언트의 임시 포트 번호로 사용
- TCP
  - 신뢰할 수 없는 공용망에서 정보 유실없는 통신을 보장하기 위해 세션을 안전하게 연결하고 데이터를 분할하고 분할된 패킷이 잘 전송되었는지 확인하는 기능을 가진 프로토콜
  - 송신자와 수신자가 3개의 패킷을 주고 받아야 한다면 송신자 측에서 1번 패킷을 전송하면 수신자 측에서 1번을 잘 받으면 2번을 요청하고 송신자 측에서 2번을 전송하고 수신자 측에서 2번을 전송받았다면 3번을 요청을 하고 송신자에서 3번을 전송하고 수신자 측에서 3번을 받으면 데이터를 전부 받았다고 알려주고 통신을 종료
  - 유실 없는 안전한 통신을 위해서 통신 시작 전에 사전 연결 작업을 수행, 클라이언트가 서버에게 Syn 신호를 전송하고 서버는 Syn과 Ack를 전송하고 다시 클라이언트는 Ack를 전송해서 연결을 수행
  - 네트워크 프로그램을 직접 만든다면 중요한 데이터 전송은 반드시 TCP 방식을 사용해야
- UDP
  - 사전 연결 작업을 수행하지 않고 일방적으로 데이터를 전송하는 프로토콜
  - 음성 데이터나 실시간 스트리밍과 같이 시간에 민감한 프로토콜이나 애플리케이션을 만들 때 사용하고 사내 방송이나 증권 시세 데이터 전송에 사용하는 멀티캐스트 환경에서 사용
  - 중요하지 않은 데이터 전송이나 단방향 전송을 하는 애플리케이션을 만들 때 사용

## 스위치
### 스위치
- 2계층 주소인 MAC Address 기반으로 동작하는 장비
- 아무 설정 없이 네트워크에 연결해도 MAC Address를 기반으로 패킷을 전달하는 기본 동작을 수행할 수 있음
- 기본 동작 이외에도 한 대의 장비에서 논리적으로 네트워크를 분리할 수 있는 VLAN기능과 네트워크 루프를 방지하는 스패닝 트리 프로토콜(STP)같은 기능을 기본적으로 가지고 있음
- MAC Address Table을 만들어서 어떤 포트에 어떤 MAC Address를 가진 호스트가 연결되어 있는지 학습을 할 수 있음
  - Flooding -> Address Learning -> Forwarding/Filtering의 3가지 동작으로 설명이 가능
- Flooding: 
  - 스위치는 켜지게 되면 네트워크 관련 정보가 하나도 없음. 이 상태에서는 스위치는 허브처럼 동작. 스위치가 허브처럼 모든 포트로 패킷을 흘리는 동작을 플러딩이라함
  - 새로 부팅하지 않았는데도 자꾸 플러딩이 일어나면 스위치가 정상적으로 동작하지 않거나 주변에서 공격이 수행되는 상황
- Address Learning:
  - 모르는 MAC Address로 데이터를 전송하라고 하면 일단 플러딩을 수행하고 데이터를 전송하는 MAC Address를 주소 테이블에 기록을 함
- Forwarding/Filtering
  - 패킷이 스위치에 들어오면 도착지 MAC Address를 확인하고 자신이 가진 주소 테이블과 비교해서 맞는 정보가 있는 해당 포트로 데이터를 전송하고 다른 포트로는 데이터를 전송하지 않음

### VLAN
- 하나의 물리적인 스위치에서 여러 개의 네트워크를 나누어 사용할 수 있는 기능: Virtual Local Area Network
- VLAN을 나누게 되면 유니캐스트나 브로드캐스트로 다른 VLAN과 통신을 할 수 없음
- VLAN을 나누게 되면 VLAN 간에는 3계층 장비를 이용해서 통신을 해야 함
- 종류
  - 포트 기반의 VLAN: 포트 단위로 VLAN을 생성
  - MAC Address 기반의 VLAN: LAN을 이동하면서 사용하는 경우 MAC Address 기반으로 VLAN 생성

### STP
- SPoF(Single Point of Failure: 단일 장애점)
- 하나의 요소 때문에 장애가 발생한 경우 전체 시스템에 장애가 발생하는 것
- 네트워크에서도 하나의 장비 고장으로 전체 네트워크가 마비되는 것을 막기 위해서 이중화 또는 다중화된 네트워크를 디자인하고 구성
- 여러 개의 switch로 네트워크를 디자인하게 되면 패킷이 잘못하면 네트워크를 따라 계속 전송되는 일이 발생할 수 있음
- 루프 구조의 switch 연결이 있으면 계속해서 데이터를 전송할 수 있음
- 브로드캐스트 스톰
  - 루프 구조를 가진 네트워크에서 브로드캐스트 전송을 하는 경우 각 스위치는 데이터가 들어온 포트를 제외하고 모든 포트에 데이터를 전송
  - 이 경우 케이블을 제거하기 전까지 데이터를 계속 전송
- MAC 러닝 중복 문제
  - Switch는 출발지의 MAC Address를 가지고 테이블을 구성하는데 여기서 출발지와 실제 데이터를 전송받은 곳의 MAC Address가 다른 경우 잘못된 학습을 할 수 있음
- Spanning Tree Protocol
  - 스위치가 루프를 확인하고 적절히 포트를 사용하지 못하도록 하는 것
  - 